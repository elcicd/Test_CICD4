templateVars:
  INSTANCE_1: instance1
  INSTANCE_2: instance2
  CPU_UTILIZATION: 90
  MIN_REPLICAS: 1
  MAX_REPLICAS: 3
  TOPIC: topic
  TOPIC_NAME: topicname
  CGROUP: cgroup
  INSTANCE_2_PORT: 8082
  
templateVars-qa:
  CPU_UTILIZATION: 50
  MAX_REPLICAS: 2
  
templateVars-prod:
  MIN_REPLICAS: 2
  MAX_REPLICAS: 5

templates:
- templateName: deploymentService
  appName: ${MICROSERVICE_NAME}-${INSTANCE_1}  
  env:
  - name: ${TOPIC_NAME}
    value: ${INSTANCE_1}-${TOPIC}
  - name: password
    valueFrom:
      secretKeyRef:
        key: password
        name: ${MICROSERVICE_NAME}-sealed-secret
  - name: ${TOPIC_NAME}
    valueFrom:
      configMapKeyRef:
        key: ${TOPIC_NAME}
        name: ${MICROSERVICE_NAME}-${INSTANCE_1}-configmap
  - name: ${CGROUP}
    valueFrom:
      configMapKeyRef:
        key: ${CGROUP}
        name: ${MICROSERVICE_NAME}-${INSTANCE_1}-configmap

- templateName: ingress
  appName: ${MICROSERVICE_NAME}-${INSTANCE_1}

- templateName: configMap
  appName: ${MICROSERVICE_NAME}-${INSTANCE_1}-configmap
  data:
    ${CGROUP}: ${CGROUP}
    ${TOPIC_NAME}: ${SDLC_ENV}-${INSTANCE_1}-${TOPIC}

- templateName: horizontalPodAutoscaler
  appName: ${MICROSERVICE_NAME}-${INSTANCE_1}
  maxReplicas: ${MAX_REPLICAS}
  minReplicas: ${MIN_REPLICAS}
  metrics:
  - type: Resource
    name: cpu
    target:
      type: Utilization
      averageUtilization: ${CPU_UTILIZATION}

- templateName: deploymentService
  appName: ${MICROSERVICE_NAME}-${INSTANCE_2}
  env:
  - name: ${TOPIC_NAME}
    value: ${INSTANCE_2}-${TOPIC}
  port: ${INSTANCE_2_PORT}

- templateName: ingress
  appName: ${MICROSERVICE_NAME}-${INSTANCE_2}
  port: ${INSTANCE_2_PORT}

- templateName: configMap
  appName: ${MICROSERVICE_NAME}-${INSTANCE_2}-configmap
  data:
    ${TOPIC_NAME}: ${SDLC_ENV}-${INSTANCE_2}-${TOPIC}
